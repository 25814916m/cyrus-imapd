#
# This file is specific to Carnegie Mellon University's
# software build process
# 
# $Id: SMakefile,v 1.58 2000/05/07 19:53:36 leg Exp $
#

if test ! -x configure; then
  echo autoheader
  autoheader
  echo aclocal -I cmulocal
  aclocal -I cmulocal
  echo autoconf
  autoconf
fi

MAKE=gmake

# settings; we have to disable these on some platforms
DEBUG=""
WITHAUTH="--with-auth=krb_pts"

if test "${CC-unset}" = "unset"; then
  CC=cc
fi

VER=`smake -D | sed 's;^.*\/;;'`
LOCALDEFS="-DEXTRA_IDENT=\\\"$VER\\\""

# PERL CONFIGURATION
PERL_MM_OPT="INSTALLPRIVLIB=${DESTDIR}/usr/local/lib/perl5 INSTALLARCHLIB=${DESTDIR}/usr/local/lib/perl5/5.002 INSTALLSITELIB=${DESTDIR}/usr/local/lib/perl5/site_perl INSTALLSITEARCH=${DESTDIR}/usr/local/lib/perl5/site_perl INSTALLBIN=${DESTDIR}/usr/local/bin INSTALLMAN1DIR=${DESTDIR}/usr/local/man/man1 INSTALLMAN3DIR=${DESTDIR}/usr/local/man/man3"
export PERL_MM_OPT

# end perl configuration

case `uname` in	
    Linux) 
	CC="gcc"
	CFLAGS="${CFLAGS} -O3 -g -Wall"
	LDFLAGS="${LDFLAGS}"
	#LIBS="-ldbm"
	export LIBS

        if test "${WASH_CYRUS_DEBUG}" = "t"; then
	    CC="gcc"
	    CFLAGS="-g"
            LDFLAGS="${LDFLAGS}"
        fi
    ;;
    SunOS)
#      CFLAGS="${CFLAGS} -xs -xO3 -xdepend"
#      LDFLAGS="${LDFLAGS} -xs -xO3 -xdepend"

	CC="gcc"
        CFLAGS="${CFLAGS} -g -O3 -Wall"
        LDFLAGS="${LDFLAGS} -L/usr/local/lib -Wl,-R,/usr/local/lib"

#     if test "${WASH_CYRUS_DEBUG}" = "t"; then
#        CFLAGS="-g -xs"
#        LDFLAGS="-L/usr/local/lib -R/usr/local/lib -xs -g"
#      fi

      if test "${WASH_CYRUS_DEBUG}" = "t"; then
        CFLAGS="-g"
      fi
      ;;
  *)    
  ;;
esac

if test "${WASH_CYRUS_DEBUG}" = "t"; then
  DEBUG="--enable-debug"
fi

MFCOMMAND="./configure $WITHAUTH --with-inn=/usr/news --enable-experiment --enable-cmulocal --with-cyrus-group=staff --with-openssl=/usr/local/lib $DEBUG"

export CFLAGS CC VER LNCOMMAND LOCALDEFS LDFLAGS
